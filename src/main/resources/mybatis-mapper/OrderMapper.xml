<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.movie.mapper.OrderMapper">
    <select id="selectOrderByMember" parameterType="Long" resultType="com.example.movie.dto.OrderDTO">
        SELECT
            id
             ,ticketCount
             ,screenDate
             ,seat
             ,totalPrice
        FROM
            ticket
        WHERE
            member_id = #{member_id}
          AND
            orderStatus = 'Y'
        ORDER BY
            id
                DESC
    </select>

    <select id="selectMovieIds" parameterType="Long" resultType="Long">
        SELECT
            movie_id
        FROM
            ticket
        WHERE
            member_id = #{member_id}
          AND
            orderStatus = 'Y'
        ORDER BY
            id
                DESC
    </select>

    <select id="selectTheaterIds" parameterType="Long" resultType="Long">
        SELECT
            theater_id
        FROM
            ticket
        WHERE
            member_id = #{member_id}
          AND
            orderStatus = 'Y'
        ORDER BY
            id
        DESC
    </select>

    <select id="selectMovieIds" parameterType="Long" resultType="com.example.movie.dto.OrderDTO">
        SELECT
            movie_id
        FROM
            ticket
        WHERE
            member_id = #{member_id}
        AND
            orderStatus = 'Y'
        ORDER BY
            id
        DESC
    </select>

    <select id="selectTheaterIds" parameterType="Long" resultType="com.example.movie.dto.OrderDTO">
        SELECT
            theater_id
        FROM
            ticket
        WHERE
            member_id = #{member_id}
        AND
            orderStatus = 'Y'
        ORDER BY
            id
        DESC
    </select>

<!--    <select id="selectOrderByMember" parameterType="Long" resultType="com.example.movie.dto.OrderDTO">-->
<!--        SELECT-->
<!--            id-->
<!--             ,(select movieName from movie where movie.id = ticket.movie_id) as movie_id-->
<!--             ,(select theaterName from theater where theater.id = ticket.theater_id) as theater_id-->
<!--             ,ticketCount-->
<!--             ,screenDate-->
<!--             ,seat-->
<!--             ,totalPrice-->
<!--        FROM-->
<!--            ticket-->
<!--        WHERE-->
<!--            member_id = #{member_id}-->
<!--          AND-->
<!--            orderStatus = 'Y'-->
<!--        ORDER BY-->
<!--            id-->
<!--                DESC-->
<!--    </select>-->

<!--    <select id="selectOrderByMember" parameterType="Long" resultType="com.example.movie.dto.OrderDTO">-->
<!--        SELECT-->
<!--            B.id-->
<!--            ,A.movieName-->
<!--            ,C.theaterName-->
<!--            ,B.ticketCount-->
<!--            ,B.screenDate-->
<!--            ,B.seat-->
<!--            ,B.totalPrice-->
<!--        FROM-->
<!--            movie A JOIN ticket B-->
<!--            ON A.id = B.movie_id-->
<!--            JOIN theater C-->
<!--            ON C.id = B.theater_id-->
<!--        WHERE-->
<!--            member_id = #{member_id}-->
<!--        AND-->
<!--            orderStatus = 'Y'-->
<!--        ORDER BY-->
<!--            B.id-->
<!--        DESC-->
<!--    </select>-->

    <select id="selectCancelOrder" parameterType="Long" resultType="com.example.movie.dto.OrderDTO">
        SELECT
            id
             ,screenDate
             ,indate
             ,totalPrice
        FROM
            ticket
        WHERE
            member_id = #{member_id}
          AND
            orderStatus = 'N'
        ORDER BY
            id
                DESC
    </select>

    <select id="selectCancelMovieIds" parameterType="Long" resultType="Long">
        SELECT
            movie_id
        FROM
            ticket
        WHERE
            member_id = #{member_id}
          AND
            orderStatus = 'N'
        ORDER BY
            id
                DESC
    </select>

    <select id="selectCancelTheaterIds" parameterType="Long" resultType="Long">
        SELECT
            theater_id
        FROM
            ticket
        WHERE
            member_id = #{member_id}
          AND
            orderStatus = 'N'
        ORDER BY
            id
                DESC
    </select>

    <select id="selectOrderById" parameterType="Long" resultType="com.example.movie.dto.OrderDTO">
        SELECT
            id
             ,screenDate
             ,ticketCount
             ,indate
             ,seat
             ,totalPrice
        FROM
            ticket
        WHERE
            member_id = #{member_id}
          AND
            orderStatus = 'Y'
        ORDER BY
            id
                DESC
            LIMIT 1
    </select>

    <select id="selectMovieIdOne" parameterType="Long" resultType="Long">
        SELECT
            movie_id
        FROM
            ticket
        WHERE
            member_id = #{member_id}
        AND
            orderStatus = 'Y'
        ORDER BY
            id
        DESC
            LIMIT 1
    </select>

    <select id="selectTheaterIdOne" parameterType="Long" resultType="Long">
        SELECT
            theater_id
        FROM
            ticket
        WHERE
            member_id = #{member_id}
          AND
            orderStatus = 'Y'
        ORDER BY
            id
        DESC
        LIMIT 1
    </select>

    <update id="updateOrderStatus" parameterType="Long">
        UPDATE
            ticket
        SET
            orderStatus = 'N'
        WHERE
            id = #{id}
    </update>
</mapper>